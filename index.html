<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Prediksi Depresi</title>
    <!-- Memuat Tailwind CSS untuk styling cepat dan modern -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

    <div class="container mx-auto p-4 sm:p-8 max-w-2xl">
        <div class="bg-white shadow-lg rounded-lg p-6 sm:p-8">
            
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2 text-center">Formulir Prediksi Depresi</h1>
            <p class="text-gray-600 mb-6 text-center">Masukkan data pasien untuk mendapatkan hasil prediksi.</p>
            
            <!-- Formulir untuk input data pasien -->
            <form id="depression-prediction-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                
                <!-- Gender -->
                <div class="form-group">
                    <label for="gender" class="block text-sm font-medium text-gray-700">Gender</label>
                    <select id="gender" name="gender" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Pilih Gender</option>
                        <option value=1>Male</option>
                        <option value=0>Female</option>
                        
                    </select>
                </div>

                <!-- Age -->
                <div class="form-group">
                    <label for="age" class="block text-sm font-medium text-gray-700">Usia (Age)</label>
                    <input type="number" id="age" name="age" required placeholder="Masukkan Usia" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>

                <!-- work_pressure -->
                <div class="form-group">
                    <label for="work_pressure" class="block text-sm font-medium text-gray-700">work pressure</label>
                    <select id="work_pressure" name="work_pressure" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Pilih Opsi</option>
                        <option value=1>Sangat Rendah</option>
                        <option value=2>Rendah</option>
                        <option value=3>Medium</option>
                        <option value=4>Tinggi</option>
                        <option value=5>Sangat Tinggi</option>
                        
                    </select>
                </div>

                <!-- job_satisfaction -->
                <div class="form-group">
                    <label for="job_satisfaction" class="block text-sm font-medium text-gray-700">job_satisfaction</label>
                    <select id="job_satisfaction" name="job_satisfaction" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Pilih Opsi</option>
                        <option value=1>Sangat Rendah</option>
                        <option value=2>Rendah</option>
                        <option value=3>Medium</option>
                        <option value=4>Tinggi</option>
                        <option value=5>Sangat Tinggi</option>
                    </select>
                </div>

                <!-- financial_stress -->
                <div class="form-group">
                    <label for="financial_stress" class="block text-sm font-medium text-gray-700">financial_stress</label>
                    <select id="financial_stress" name="financial_stress" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Pilih Opsi</option>
                        <option value=1>Sangat Rendah</option>
                        <option value=2>Rendah</option>
                        <option value=3>Medium</option>
                        <option value=4>Tinggi</option>
                        <option value=5>Sangat Tinggi</option>
                    </select>
                </div>

                <!-- sleep_duration -->
                <div class="form-group">
                    <label for="sleep_duration" class="block text-sm font-medium text-gray-700">sleep_duration</label>
                    <select id="sleep_duration" name="sleep_duration" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Pilih Tipe</option>
                        <option value=0>Less than 5 Hours</option>
                        <option value=1>5-6 Hours</option>
                        <option value=2>7-8 Hours</option>
                        <option value=3>More than 8 Hours</option>
                    </select>
                </div>

                <!-- dietary_habits -->
                <div class="form-group">
                    <label for="dietary_habits" class="block text-sm font-medium text-gray-700">dietary_habits</label>
                    <select id="dietary_habits" name="dietary_habits" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Pilih Tipe</option>
                        <option value=0>Healthy</option>
                        <option value=1>Moderate</option>
                        <option value=2>Unhealthy</option>
                    </select>
                </div>

                <!-- Have you ever had suicidal thoughts ? -->
                <div class="form-group">
                    <label for="suicidal_thoughts" class="block text-sm font-medium text-gray-700">Have you ever had suicidal thoughts ?</label>
                    <select id="suicidal_thoughts" name="suicidal_thoughts" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Pilih Status</option>
                        <option value=1>Yes</option>
                        <option value=0>No</option>
                    </select>
                </div>

                <!-- work_hours -->
                <div class="form-group">
                    <label for="work_hours" class="block text-sm font-medium text-gray-700">work_hours</label>
                    <input type="number" id="work_hours" name="work_hours" required placeholder="Masukkan work hours " class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>

                <!-- Family History of Mental Illness' -->
                <div class="form-group">
                    <label for="family_history_of_mental_illness" class="block text-sm font-medium text-gray-700">Family History of Mental Illness</label>
                    <select id="family_history_of_mental_illness" name="family_history_of_mental_illness" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Pilih Status</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>

                <!-- Submit Button -->
                <div class="md:col-span-2">
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Prediksi Depression
                    </button>
                </div>
            </form>

            <!-- Area untuk menampilkan hasil dan error -->
            <div class="mt-8">
                <!-- Div ini spesifik untuk menampilkan hasil prediksi -->
                <div id="result-container" class="hidden p-4 rounded-md text-center font-semibold text-lg"></div>

                <!-- Div ini spesifik untuk menampilkan pesan error -->
                <div id="error-message" class="mt-4 text-center text-red-600 font-medium"></div>
            </div>

        </div>
    </div>

    <script>
    // Menambahkan event listener ke form saat disubmit
    document.getElementById('depression-prediction-form').addEventListener('submit', async function(event) {
        // Mencegah form dari perilaku default (reload halaman)
        event.preventDefault();

        // Mengambil elemen-elemen penting dari halaman
        const form = event.target;
        const submitButton = form.querySelector('button[type="submit"]');
        const resultContainer = document.getElementById('result-container');
        const errorDiv = document.getElementById('error-message'); // Elemen untuk menampilkan error

        // 1. Memulai status loading untuk memberikan feedback ke user
        submitButton.disabled = true;
        submitButton.textContent = 'Memprediksi...';
        resultContainer.classList.add('hidden'); // Sembunyikan hasil sebelumnya
        errorDiv.textContent = ''; // Kosongkan pesan error sebelumnya

        // 2. Mengambil semua data dari form dan mengubahnya menjadi objek
        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => {
            // Mengonversi semua nilai menjadi angka (integer)
            // Ini penting karena model Anda mengharapkan input numerik
            data[key] = parseInt(value, 10);
        });

        // 3. Mengirim data ke backend menggunakan Fetch API
        try {
            const response = await fetch('http://localhost:5000/predict', {
                method: 'POST',
                headers: {
                    // Header ini wajib ada agar Flask tahu kita mengirim JSON
                    'Content-Type': 'application/json'
                },
                // Mengubah objek JavaScript menjadi string JSON
                body: JSON.stringify(data)
            });

            // Mengambil respons dari server dalam format JSON
            const result = await response.json();

            // Jika server mengembalikan error (misal: status 500)
            if (!response.ok) {
                // Lemparkan error agar bisa ditangkap oleh blok 'catch'
                throw new Error(result.error || 'Terjadi kesalahan pada server.');
            }

            // 4. Menampilkan hasil prediksi yang sukses
            resultContainer.classList.remove('hidden');
            if (result.depression === 1) {
                resultContainer.textContent = 'Hasil Prediksi: Terindikasi Depresi';
                // Memberi warna latar belakang merah untuk indikasi positif
                resultContainer.className = 'p-4 rounded-md text-center font-semibold text-lg bg-red-100 text-red-800';
            } else {
                resultContainer.textContent = 'Hasil Prediksi: Tidak Terindikasi Depresi';
                // Memberi warna latar belakang hijau untuk indikasi negatif
                resultContainer.className = 'p-4 rounded-md text-center font-semibold text-lg bg-green-100 text-green-800';
            }

        } catch (error) {
            // 5. Menampilkan pesan error jika terjadi masalah
            console.error('Error saat mengirim data:', error);
            errorDiv.textContent = 'Gagal terhubung ke server atau terjadi kesalahan. Pastikan backend berjalan. Detail: ' + error.message;
        } finally {
            // 6. Mengembalikan tombol ke keadaan normal, baik sukses maupun gagal
            submitButton.disabled = false;
            submitButton.textContent = 'Prediksi';
        }
    });
</script>

</body>
</html>
